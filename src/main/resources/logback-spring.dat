<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <springProfile name="dev">
        <property scope="context" name="apiStream" value="gce-dev-api-kinesis-firehose-stream"/>
        <property scope="context" name="errorStream" value="gce-dev-exceptions-kinesis-firehose-stream"/>
        <property scope="context" name="traceStream" value="gce-dev-trace-kinesis-firehose-stream"/>
        <property scope="context" name="streamRegion" value="eu-west-1"/>
        <appender name="FIREHOSE-INFO" class="com.szells.gce.core.utilities.logbackappender.FirehoseAppender">
            <bufferSize>1000</bufferSize>
            <threadCount>20</threadCount>
            <region>${streamRegion}</region>
            <maxRetries>3</maxRetries>
            <shutdownTimeout>30</shutdownTimeout>
            <compressionEnabled>true</compressionEnabled>
            <streamName>${apiStream}</streamName>
            <encoding>UTF-8</encoding>
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>%msg</pattern>
            </layout>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>INFO</level>
                <onMatch>ACCEPT</onMatch>
                <onMismatch>DENY</onMismatch>
            </filter>
        </appender>

        <appender name="FIREHOSE-ERROR" class="com.szells.gce.core.utilities.logbackappender.FirehoseAppender">
            <bufferSize>1000</bufferSize>
            <threadCount>20</threadCount>
            <region>${streamRegion}</region>
            <maxRetries>3</maxRetries>
            <shutdownTimeout>30</shutdownTimeout>
            <compressionEnabled>true</compressionEnabled>
            <streamName>${errorStream}</streamName>
            <encoding>UTF-8</encoding>
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>%msg</pattern>
            </layout>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>ERROR</level>
                <onMatch>ACCEPT</onMatch>
                <onMismatch>DENY</onMismatch>
            </filter>
        </appender>

        <appender name="FIREHOSE-TRACE" class="com.szells.gce.core.utilities.logbackappender.FirehoseAppender">
            <bufferSize>1000</bufferSize>
            <threadCount>20</threadCount>
            <region>${streamRegion}</region>
            <maxRetries>3</maxRetries>
            <shutdownTimeout>30</shutdownTimeout>
            <compressionEnabled>true</compressionEnabled>
            <streamName>${traceStream}</streamName>
            <encoding>UTF-8</encoding>
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>%msg</pattern>
            </layout>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>TRACE</level>
                <onMatch>ACCEPT</onMatch>
                <onMismatch>DENY</onMismatch>
            </filter>
        </appender>

        <logger name="com.szells.gce.core.utilities.loggingService.CoreLoggerImpl" additivity="false" level="TRACE">
            <appender-ref ref="FIREHOSE-INFO"/>
            <appender-ref ref="FIREHOSE-ERROR"/>
            <appender-ref ref="FIREHOSE-TRACE"/>
        </logger>

        <logger name="NgAuthApplication" additivity="false" level="OFF">
            <appender-ref ref="FIREHOSE-INFO"/>
            <appender-ref ref="FIREHOSE-ERROR"/>
            <appender-ref ref="FIREHOSE-TRACE"/>
        </logger>

        <root level="OFF">
            <appender-ref ref="FIREHOSE-INFO"/>
            <appender-ref ref="FIREHOSE-ERROR"/>
            <appender-ref ref="FIREHOSE-TRACE"/>
        </root>
    </springProfile>
    <springProfile name="qa">
        <property scope="context" name="apiStream" value="gce-qa-api-kinesis-firehose-stream"/>
        <property scope="context" name="errorStream" value="gce-qa-exceptions-kinesis-firehose-stream"/>
        <property scope="context" name="traceStream" value="gce-qa-trace-kinesis-firehose-stream"/>
        <property scope="context" name="streamRegion" value="eu-west-1"/>
        <appender name="FIREHOSE-INFO" class="com.szells.gce.core.utilities.logbackappender.FirehoseAppender">
            <bufferSize>1000</bufferSize>
            <threadCount>20</threadCount>
            <region>${streamRegion}</region>
            <maxRetries>3</maxRetries>
            <shutdownTimeout>30</shutdownTimeout>
            <compressionEnabled>true</compressionEnabled>
            <streamName>${apiStream}</streamName>
            <encoding>UTF-8</encoding>
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>%msg</pattern>
            </layout>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>INFO</level>
                <onMatch>ACCEPT</onMatch>
                <onMismatch>DENY</onMismatch>
            </filter>
        </appender>

        <appender name="FIREHOSE-ERROR" class="com.szells.gce.core.utilities.logbackappender.FirehoseAppender">
            <bufferSize>1000</bufferSize>
            <threadCount>20</threadCount>
            <region>${streamRegion}</region>
            <maxRetries>3</maxRetries>
            <shutdownTimeout>30</shutdownTimeout>
            <compressionEnabled>true</compressionEnabled>
            <streamName>${errorStream}</streamName>
            <encoding>UTF-8</encoding>
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>%msg</pattern>
            </layout>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>ERROR</level>
                <onMatch>ACCEPT</onMatch>
                <onMismatch>DENY</onMismatch>
            </filter>
        </appender>

        <appender name="FIREHOSE-TRACE" class="com.szells.gce.core.utilities.logbackappender.FirehoseAppender">
            <bufferSize>1000</bufferSize>
            <threadCount>20</threadCount>
            <region>${streamRegion}</region>
            <maxRetries>3</maxRetries>
            <shutdownTimeout>30</shutdownTimeout>
            <compressionEnabled>true</compressionEnabled>
            <streamName>${traceStream}</streamName>
            <encoding>UTF-8</encoding>
            <layout class="ch.qos.logback.classic.PatternLayout">
                <pattern>%msg</pattern>
            </layout>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>TRACE</level>
                <onMatch>ACCEPT</onMatch>
                <onMismatch>DENY</onMismatch>
            </filter>
        </appender>

        <logger name="com.szells.gce.core.utilities.loggingService.CoreLoggerImpl" additivity="false" level="TRACE">
            <appender-ref ref="FIREHOSE-INFO"/>
            <appender-ref ref="FIREHOSE-ERROR"/>
            <appender-ref ref="FIREHOSE-TRACE"/>
        </logger>

        <logger name="NgAuthApplication" additivity="false" level="OFF">
            <appender-ref ref="FIREHOSE-INFO"/>
            <appender-ref ref="FIREHOSE-ERROR"/>
            <appender-ref ref="FIREHOSE-TRACE"/>
        </logger>

        <root level="OFF">
            <appender-ref ref="FIREHOSE-INFO"/>
            <appender-ref ref="FIREHOSE-ERROR"/>
            <appender-ref ref="FIREHOSE-TRACE"/>
        </root>
    </springProfile>
    <springProfile name="local">
        <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder class="net.logstash.logback.encoder.LogstashEncoder">
                <fieldNames>
                    <message>[ignore]</message>
                </fieldNames>
                <customFields>{"application":"auth-service"}</customFields>
                <provider class="net.logstash.logback.composite.loggingevent.LoggingEventPatternJsonProvider">
                    <omitEmptyFields>true</omitEmptyFields>
                    <pattern>
                        {
                        "transactionLog": "#asJson{%message}"
                        }
                    </pattern>
                </provider>
            </encoder>

            <target>System.out</target>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>DEBUG</level>
                <onMatch>ACCEPT</onMatch>
            </filter>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>INFO</level>
                <onMatch>ACCEPT</onMatch>
            </filter>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>TRACE</level>
                <onMatch>ACCEPT</onMatch>
            </filter>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>WARN</level>
                <onMatch>DENY</onMatch>
            </filter>
            <filter class="ch.qos.logback.classic.filter.LevelFilter">
                <level>ERROR</level>
                <onMatch>DENY</onMatch>
            </filter>
        </appender>
        <appender name="STDERR" class="ch.qos.logback.core.ConsoleAppender">
            <target>System.err</target>
            <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
                <level>WARN</level>
            </filter>
            <encoder class="net.logstash.logback.encoder.LogstashEncoder">
                <fieldNames>
                    <message>[ignore]</message>
                </fieldNames>
                <customFields>{"application":"auth-service"}</customFields>
                <provider class="net.logstash.logback.composite.loggingevent.LoggingEventPatternJsonProvider">
                    <omitEmptyFields>true</omitEmptyFields>
                    <pattern>
                        {
                        "transactionLog": "#asJson{%message}"
                        }
                    </pattern>
                </provider>
            </encoder>
        </appender>

        <!-- LOG everything at INFO level -->
        <root level="info">
            <appender-ref ref="STDERR"/>
            <appender-ref ref="STDOUT"/>
        </root>
    </springProfile>
</configuration>